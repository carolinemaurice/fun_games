<div class="mx-3">
  <% if policy(@game).destroy? %>
    <%= link_to "❌", game_path(@game), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}%>
  <% end %>
  <% if policy(@game).edit? %>
    <%= link_to "edit this game", edit_game_path(@game)%>
   <% end %>
  <%= link_to "book this game", new_game_booking_path(@game) if @game.user != current_user %>
</div>

<div class="container">
  <div class="row">
    <div class="col-6 d-flex flex-column">
      <h2 > <%= @game.name%> </h2>
      <p> <em><%= @game.user.username %></em></p>

      <h5> <strong><%= @game.address %> | <%=@game.price_per_day %> euros per day</strong> </h5>
      <p> Minimum players : <%= @game.players %> | Minimum age : <%=@game.minimum_age %> years old</p>
      <p> <%=@game.description %></p>

      <%= cl_image_tag @game.photos[0].key, height: 300, width: 400, crop: :fill %>
    </div>
    <div class="col-6 d-flex flex-column">
      <% if current_user == @game.user%>
            <h1>Upcoming reservations</h1>
          <% @upcoming_bookings.each do |booking| %>
            <div class="card-product">
              <%= image_tag user_avatar(booking.user), class: 'avatar' %>
              <div class="card-product-infos position-relative">
              <i class="fa-regular fa-circle-check booking-check"></i>
                <p> Booked <%= (booking.end_date - booking.start_date).to_i %> days by <%=booking.user.username%></p>
                <p> From <%= booking.start_date %> to <%= booking.end_date %></p>
                <p><%=(booking.end_date - booking.start_date).to_i * booking.game.price_per_day %>€</p>
                <p>Confirmed</p>
              </div>
            </div>
          <% end %>
            <h1>Reservations history</h1>
          <% @history_bookings.each do |booking| %>
            <div class="card-product">
              <%= image_tag user_avatar(booking.user), class: 'avatar' %>
              <div class="card-product-infos position-relative">
            <i class="fa-regular fa-circle-xmark booking-done"></i>
                <p> Booked <%= (booking.end_date - booking.start_date).to_i %> days by <%=booking.user.username%></p>
                <p> From <%= booking.start_date %> to <%= booking.end_date %></p>
                <p><%=(booking.end_date - booking.start_date).to_i * booking.game.price_per_day %>€</p>
                <p>Declined</p>
              </div>
            </div>
          <% end %>
        </div>
      </div>
  </div>
    <% else %>
    <div  class="col-6 d-flex flex-column" style="width: 50%; height: 400px;"
      data-controller="map"
      data-map-markers-value="<%= @markers.to_json %>"
      data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
    <% end %>
</div>
